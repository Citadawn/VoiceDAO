## 概述

---

状态信息区块是主界面中展示 TTS
引擎状态、音频保存目录、朗读状态等关键信息的重要区域。本指南面向未接触过本项目的开发者，指导如何在主界面状态信息区块中规范地添加新的状态信息项。

**遵循规范**：请严格遵循本项目 [CONTRIBUTING.md](../../CONTRIBUTING.md) 的协作规范（分层、分区、命名、国际化与资源管理等）。

## 位置说明

---

状态信息区块位于主界面布局文件 `app/src/main/res/layout/activity_main.xml` 中，注释如下：

```xml
<!-- 状态信息区块：展示 TTS 引擎状态、音频保存目录、朗读状态等信息。参见术语表 StatusInfoBlock -->
<LinearLayout
    android:layout_width="0dp"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    ... >
    <!-- 每项状态信息均为一行，标题加粗，内容正常 -->
    ...
</LinearLayout>
```

## 添加状态信息的标准

---

### 布局规范

- **每项一行**：每个状态信息项使用一个 `LinearLayout` 横向排列，包含标题和内容
- **标题加粗**：标题使用 `TextView`，`android:textStyle="bold"`
- **内容正常**：内容使用 `TextView`，常规字体
- **间距统一**：使用 `android:layout_marginBottom="@dimen/dp_8"` 保持项目间距

### 资源管理规范

- **国际化**：所有文本内容必须引用 `@string/*` 资源，禁止硬编码
- **颜色规范**：文本颜色统一使用主题属性 `?attr/colorOnSurface`
- **字号规范**：字号统一从 `@dimen` 获取，禁止写 `sp/dp` 字面量
- **语义色使用**：若需状态语义色（如警示/支持度），仅使用项目语义色资源（如 `@color/accent_warning`、
  `@color/tts_support_*`）

### 代码规范

- **注释清晰**：每项新增状态信息前需添加中文注释，说明用途
- **分层与分区**：如需在代码中获取或更新状态，请在 `MainActivity` 中的 `// region 状态信息区块 // endregion`
  分区内维护相关逻辑

## 快速开始

---

### 步骤 1：添加 XML 布局

在 `activity_main.xml` 的状态信息区块中添加新的状态信息项：

```xml
<!-- 新增：网络连接状态（遵循主题与资源规范） -->
<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="horizontal"
    android:layout_marginBottom="@dimen/dp_8">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@string/label_network_status"
        android:textStyle="bold"
        android:textColor="?attr/colorOnSurface"
        android:textSize="@dimen/sp_13" />

    <TextView
        android:id="@+id/tvNetworkStatus"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text=""
        android:textColor="?attr/colorOnSurface"
        android:textSize="@dimen/sp_13" />
</LinearLayout>
```

### 步骤 2：添加字符串资源

在 `app/src/main/res/values/strings.xml` 和 `app/src/main/res/values-zh/strings.xml` 中添加对应的字符串资源：

```xml
<!-- values/strings.xml -->
<string name="label_network_status">Network Status:</string>
<string name="network_connected">Connected</string>
<string name="network_disconnected">Disconnected</string>

<!-- values-zh/strings.xml -->
<string name="label_network_status">网络状态：</string>
<string name="network_connected">已连接</string>
<string name="network_disconnected">未连接</string>
```

### 步骤 3：添加 Java 代码

在 `MainActivity.java` 中添加状态更新逻辑：

```java
// MainActivity.java
// region 状态信息区块
private TextView tvNetworkStatus;

private void initializeStatusInfoBlock() {
    // 初始化状态信息控件
    tvNetworkStatus = findViewById(R.id.tvNetworkStatus);

    // 初始化状态信息
    updateNetworkStatus();
}

private void updateNetworkStatus() {
    // 检查网络连接状态
    boolean isConnected = checkNetworkConnection();

    // 更新状态显示
    if (isConnected) {
        tvNetworkStatus.setText(getString(R.string.network_connected));
        tvNetworkStatus.setTextColor(ContextCompat.getColor(this, R.color.tts_support_available));
    } else {
        tvNetworkStatus.setText(getString(R.string.network_disconnected));
        tvNetworkStatus.setTextColor(ContextCompat.getColor(this, R.color.accent_warning));
    }
}

private boolean checkNetworkConnection() {
    // 实现网络连接检查逻辑
    // 这里只是示例，实际实现需要根据具体需求
    return true;
}
// endregion
```

## 完整示例

---

### 示例：添加"音频保存状态"信息项

#### 1. XML 布局

```xml
<!-- 新增：音频保存状态 -->
<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="horizontal"
    android:layout_marginBottom="@dimen/dp_8">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@string/label_audio_save_status"
        android:textStyle="bold"
        android:textColor="?attr/colorOnSurface"
        android:textSize="@dimen/sp_13" />

    <TextView
        android:id="@+id/tvAudioSaveStatus"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text=""
        android:textColor="?attr/colorOnSurface"
        android:textSize="@dimen/sp_13" />
</LinearLayout>
```

#### 2. 字符串资源

```xml
<!-- values/strings.xml -->
<string name="label_audio_save_status">Audio Save Status:</string>
<string name="audio_save_ready">Ready</string>
<string name="audio_save_saving">Saving...</string>
<string name="audio_save_error">Error</string>

<!-- values-zh/strings.xml -->
<string name="label_audio_save_status">音频保存状态：</string>
<string name="audio_save_ready">就绪</string>
<string name="audio_save_saving">保存中...</string>
<string name="audio_save_error">错误</string>
```

#### 3. Java 代码

```java
// MainActivity.java
// region 状态信息区块
private TextView tvAudioSaveStatus;

private void initializeStatusInfoBlock() {
    // 初始化状态信息控件
    tvAudioSaveStatus = findViewById(R.id.tvAudioSaveStatus);

    // 初始化状态信息
    updateAudioSaveStatus();
}

private void updateAudioSaveStatus() {
    // 检查音频保存状态
    AudioSaveStatus status = getAudioSaveStatus();

    switch (status) {
        case READY:
            tvAudioSaveStatus.setText(getString(R.string.audio_save_ready));
            tvAudioSaveStatus.setTextColor(ContextCompat.getColor(this, R.color.tts_support_available));
            break;
        case SAVING:
            tvAudioSaveStatus.setText(getString(R.string.audio_save_saving));
            tvAudioSaveStatus.setTextColor(ContextCompat.getColor(this, R.color.accent_warning));
            break;
        case ERROR:
            tvAudioSaveStatus.setText(getString(R.string.audio_save_error));
            tvAudioSaveStatus.setTextColor(ContextCompat.getColor(this, R.color.accent_warning));
            break;
    }
}

private AudioSaveStatus getAudioSaveStatus() {
    // 实现音频保存状态检查逻辑
    return AudioSaveStatus.READY;
}

enum AudioSaveStatus {
    READY, SAVING, ERROR
}
// endregion
```

## 注意事项

---

### 必须遵循的规范

- **资源引用**：所有文本、颜色、尺寸必须使用资源引用，禁止硬编码
- **国际化**：必须同时添加中英文字符串资源，ID 保持一致
- **代码分区**：相关逻辑放在 `// region 状态信息区块 // endregion` 分区中
- **主题属性**：文本颜色使用 `?attr/colorOnSurface`，避免硬编码颜色值

### 开发建议

- **线程安全**：如需展示动态信息，确保线程安全与生命周期安全
- **性能考虑**：避免频繁更新状态信息，合理控制更新频率
- **错误处理**：状态更新逻辑应包含适当的异常处理
- **资源清理**：及时清理未使用的资源和空目录

### 常见问题

1. **状态信息不显示**：检查 XML 布局是否正确添加，以及 `findViewById` 是否正确调用
2. **国际化不生效**：检查中英文字符串资源 ID 是否完全一致
3. **颜色显示异常**：确认是否正确使用了主题属性或项目语义色
4. **状态更新不及时**：检查状态更新逻辑是否正确调用，以及线程安全问题

## 相关文档

---

- [CONTRIBUTING.md](../../CONTRIBUTING.md) - 项目协作规范
- [信息图标开发指南](./信息图标开发指南.md) - 信息图标的标准模板和使用方法
- [测试模式添加测试项指南](./测试模式添加测试项指南.md) - 为测试模式新增测试项的步骤
- [README.md](../../README.md) - 项目说明文档
- [文档索引](../文档索引.md) - 返回文档索引
