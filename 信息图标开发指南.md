## 概述

---

信息图标是应用界面中用于为用户提供帮助、说明或提示的小型图标（通常为圆形“i”），点击后会弹出详细说明。它有助于提升用户体验和界面可用性。本指南详细说明了如何按照标准模板创建和使用信息图标。

**重要提示**：为了保持全局风格统一，所有信息图标都必须通过动态定位功能统一放在 `TextView` 的右上角。这是信息图标开发的核心要求。

## 快速开始

---

### 复制 XML 模板

```xml
<LinearLayout
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:orientation="horizontal"
    android:gravity="bottom">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@string/your_text_here"
        android:textSize="@dimen/sp_16"
        android:textColor="@color/main_dark" />

    <ImageView
        android:id="@+id/ivYourInfo"
        android:layout_width="20dp"
        android:layout_height="20dp"
        android:layout_marginStart="2dp"
        android:src="@drawable/ic_info_white_20dp"
        android:contentDescription="@string/your_content_description"
        android:clickable="true"
        android:focusable="true" />
</LinearLayout>
```

### 添加字符串资源

```xml
<!-- 英文资源 -->
<string name="your_info_title">Your Info Title</string>
<string name="your_info_content"><![CDATA[
    Your info content here.<br/><br/>
    <b>Features:</b><br/>
    • Feature 1<br/>
    • Feature 2<br/>
    • Feature 3
]]></string>

<!-- 中文资源 -->
<string name="your_info_title">你的信息标题</string>
<string name="your_info_content"><![CDATA[
    你的信息内容。<br/><br/>
    <b>功能：</b><br/>
    • 功能1<br/>
    • 功能2<br/>
    • 功能3
]]></string>
```

### 添加 Java 代码

```java
@Override
private void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    // 设置信息图标的点击事件和对话框显示
    setupInfoIcons();

    // 设置信息图标的动态位置（确保统一放在 TextView 右上角）
    setupInfoIconPositions();
}

/**
 * 设置所有信息图标的点击事件和对话框内容
 * 使用 InfoIconHelper 工具类统一管理
 */
private void setupInfoIcons() {
    InfoIconHelper.setupInfoIcons(this,
        // 参数格式：{ImageView 对象, 标题字符串资源 ID, 内容字符串资源 ID}
        new Object[]{findViewById(R.id.ivYourInfo), R.string.your_info_title, R.string.your_info_content}
    );
}

/**
 * 设置信息图标的动态位置
 * 确保所有信息图标都统一放在对应 TextView 的右上角
 */
private void setupInfoIconPositions() {
    // 延迟执行，确保布局完成后再设置位置
    findViewById(android.R.id.content).post(() -> {
        // 使用 ViewHelper 根据文本内容查找对应的 TextView
        TextView tvLabel = ViewHelper.findTextViewByText(this, getString(R.string.your_text_here));
        ImageView ivInfo = findViewById(R.id.ivYourInfo);

        // 使用 InfoIconPositionHelper 设置图标位置
        // 确保图标统一放在 TextView 的右上角
        if (ivInfo != null && tvLabel != null) {
            InfoIconPositionHelper.setIconPosition(this, ivInfo, tvLabel);
        }
    });
}
```

#### 动态定位实现

动态定位是信息图标开发的核心要求，确保所有信息图标都统一放在 `TextView` 的右上角：

**在 Activity 中使用：**

```java
// 根据语言标签文本查找对应的 TextView
TextView tvLabel = ViewHelper.findTextViewByText(this, getString(R.string.label_language));

// 获取语言信息图标
ImageView ivInfo = findViewById(R.id.ivLangSupportInfo);

// 设置信息图标位置，确保统一放在 TextView 右上角
if (ivInfo != null && tvLabel != null) {
    InfoIconPositionHelper.setIconPosition(this, ivInfo, tvLabel);
}
```

**在 Dialog 中使用：**

```java
// 获取 Dialog 的根视图
View rootView = getWindow().getDecorView();
String targetText = getContext().getString(R.string.dialog_title);

// 根据对话框标题文本查找对应的 TextView
TextView tvTitle = ViewHelper.findTextViewByTargetText(rootView, targetText);

// 获取对话框信息图标
ImageView ivInfo = findViewById(R.id.ivDialogInfo);

// 设置信息图标位置，确保统一放在 TextView 右上角
if (ivInfo != null && tvTitle != null) {
    InfoIconPositionHelper.setIconPosition(getContext(), ivInfo, tvTitle);
}
```

## 属性说明

---

### 可自定义属性

- `TextView`：`text`、`textSize`、`textColor`
- `ImageView`：`id`、`contentDescription`

### 固定属性（严禁修改）

- `LinearLayout`：`layout_width`、`layout_height`、`orientation`、`gravity`
- `ImageView`：`layout_width`、`layout_height`、`layout_marginStart`、`src`、`clickable`、`focusable`

**注意**：可以适当增/删/改一些属性，但固定属性列表中的属性绝对不能修改，否则会导致信息图标无法正常工作。

## 开发流程

---

1. 复制 XML 模板：使用标准模板创建信息图标布局
2. 修改自定义属性：更改文字内容、图标 ID、内容描述
3. 添加字符串资源：在 `strings.xml` 中添加标题和内容
4. 添加 Java 代码：在 `Activity` 中调用 `setupInfoIcons()` 和 `setupInfoIconPositions()` 方法
5. 设置动态定位：确保信息图标统一放在 `TextView` 的右上角

## 使用示例

---

### 完整示例：语速信息图标

以下是一个完整的信息图标开发示例，包含 XML 布局、Java 代码和字符串资源：

#### XML 布局

```xml
<LinearLayout
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:orientation="horizontal"
    android:gravity="bottom">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@string/label_speed"
        android:textSize="@dimen/sp_16"
        android:textColor="@color/main_dark" />

    <ImageView
        android:id="@+id/ivSpeedInfo"
        android:layout_width="20dp"
        android:layout_height="20dp"
        android:layout_marginStart="2dp"
        android:src="@drawable/ic_info_white_20dp"
        android:contentDescription="@string/speed_info_title"
        android:clickable="true"
        android:focusable="true" />
</LinearLayout>
```

#### Java 代码

```java
// 在 setupInfoIcons() 方法中添加
// 设置语速信息图标的点击事件和对话框内容
new Object[]{findViewById(R.id.ivSpeedInfo), R.string.speed_info_title, R.string.speed_info_content}

// 在 setupInfoIconPositions() 方法中添加
// 根据语速标签文本查找对应的 TextView
TextView tvSpeedLabel = ViewHelper.findTextViewByText(this, getString(R.string.label_speed));
ImageView ivSpeedInfo = findViewById(R.id.ivSpeedInfo);

// 设置语速信息图标的位置，确保统一放在 TextView 右上角
if (ivSpeedInfo != null && tvSpeedLabel != null) {
    InfoIconPositionHelper.setIconPosition(this, ivSpeedInfo, tvSpeedLabel);
}
```

#### 字符串资源

```xml
<string name="speed_info_title">语速说明</string>
<string name="speed_info_content"><![CDATA[
    语速控制文本朗读的速度。<br/><br/>
    <b>使用方法：</b><br/>
    • 点击"+"按钮增加语速<br/>
    • 点击"-"按钮减少语速<br/>
    • 拖动滑块调节语速<br/>
    • 点击"重置"恢复默认语速
]]></string>
```

## 工具类说明

---

### 核心工具类

#### InfoIconHelper

- 位置：`com.citadawn.speechapp.util.InfoIconHelper`
- 功能：统一管理信息图标的点击事件和对话框显示
- 主要方法：`setupInfoIcon()`、`setupInfoIcons()`、`showInfoDialog()`

#### InfoIconPositionHelper

- 位置：`com.citadawn.speechapp.util.InfoIconPositionHelper`
- 功能：动态设置信息图标的位置，确保统一放在 `TextView` 的右上角
- 主要方法：`setIconPosition()`
- 重要性：这是信息图标开发的核心工具类，必须使用

#### ViewHelper

- 位置：`com.citadawn.speechapp.util.ViewHelper`
- 功能：提供通用的 View 查找和操作功能
- 主要方法：
  - `findTextViewByText(Activity activity, String text)` - 在 `Activity` 中根据文本内容查找 `TextView`
  - `findTextViewByText(View rootView, String text)` - 在指定根视图中根据文本内容查找 `TextView`
  - `findTextViewByTargetText(View rootView, String targetText)` - 在指定根视图中精确匹配目标文本的 `TextView`
  - `findTextViewInViewGroup(ViewGroup viewGroup, String text)` - 在 `ViewGroup` 中递归查找指定文本的 `TextView`（核心查找逻辑）

### 工具类架构

项目采用分层工具类架构，职责清晰，便于维护：

1. `InfoIconHelper` - 信息图标交互管理
   - 统一处理信息图标的点击事件
   - 管理信息对话框的显示和内容
   - 支持批量设置多个信息图标
   - 简化信息图标的交互逻辑
2. `InfoIconPositionHelper` - 信息图标位置管理（核心工具类）
   - 动态计算信息图标的精确位置
   - 基于 `TextView` 文字高度设置图标间距
   - 确保所有信息图标统一放在 `TextView` 的右上角
   - 支持自定义位置百分比，适应不同场景
3. `ViewHelper` - 通用 View 操作
   - 提供通用的 `View` 查找功能
   - 支持 `Activity`、`Dialog`、`Fragment` 等多种场景
   - 提高代码复用性，避免重复实现
   - 简化 View 查找的复杂逻辑

## 注意事项

---

### 必须遵循的规范

- 图标尺寸统一：所有信息图标都使用 20dp × 20dp
- 间距统一：图标与文字间距为 2dp
- 对齐方式：使用 `gravity="bottom"` 确保图标与文字底部对齐
- 交互属性：必须设置 `clickable="true"` 和 `focusable="true"`
- 资源引用：图标统一使用 `@drawable/ic_info_white_20dp`

### 代码质量要求

- Java 代码：必须在 `Activity` 中调用 `setupInfoIcons()` 方法
- 动态定位：必须调用 `setupInfoIconPositions()` 方法，确保信息图标统一放在 `TextView` 的右上角
- 字符串资源：必须添加对应的标题和内容字符串资源
- 国际化：必须同时添加中英文字符串资源
- HTML 格式：内容支持 HTML 标签，使用 CDATA 包装

### 常见错误

- 忘记调用 `setupInfoIcons()`：导致图标无法点击
- 忘记调用 `setupInfoIconPositions()`：导致信息图标位置不统一，影响全局风格
- 硬编码字符串：未使用字符串资源
- 修改固定属性：改变了图标尺寸或间距
- 缺少国际化：只添加了中文或英文
- HTML 格式错误：未使用 CDATA 包装 HTML 内容

## 最佳实践

---

- 优先使用工具类：避免重复实现相同功能
- 保持职责分离：每个工具类专注于特定功能
- 统一调用方式：使用标准化的方法调用
- 必须设置动态定位：确保所有信息图标都统一放在 `TextView` 的右上角，保持全局风格一致
- 及时更新文档：工具类更新时同步更新文档
- 测试验证：确保工具类在各种场景下正常工作

## 相关文档

---

- [CONTRIBUTING.md](./CONTRIBUTING.md) - 项目协作规范
- [README.md](./README.md) - 项目说明文档 