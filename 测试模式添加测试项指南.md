## 概述

---

### 什么是测试模式？

测试模式是本项目为开发者和测试人员提供的特殊功能模式。启用后，应用会显示一组可选的“测试项”，用于验证特定功能、模拟异常场景或输出调试信息，帮助开发和质量保障。

### 如何进入测试模式？

1. 启动应用，进入主界面。
2. 点击右上角菜单按钮，选择“测试模式”菜单项。
3. 在弹出的对话框中勾选需要的测试项，点击“测试”按钮即可进入测试模式。
4. 进入测试模式后，主界面会有明显提示，并可随时退出测试模式。

### 什么是测试项？

测试项是测试模式下可单独启用的功能点。每个测试项对应一个具体的测试目标（如模拟语速设置失败、输出特定日志等），可多选组合，便于灵活测试和验证。

本指南面向未接触过本项目的开发者，介绍如何为测试模式添加新的测试项。请严格遵循本项目的 [CONTRIBUTING.md](./CONTRIBUTING.md) 规范进行文档和代码编写。

## 基本原理

---

测试模式的测试项由 `TestCase` 类表示，所有测试项统一由 `TestManager` 管理，并在主界面初始化和显示。每个测试项包含唯一的 `id`、显示名称、描述等信息。

## 添加流程

---

1. 在 `TestManager` 中注册测试项
   
   打开 `app/src/main/java/com/citadawn/speechapp/ui/test/TestManager.java`，在构造方法中添加新的 `TestCase` 实例。例如：
   
   ```java
   // TestManager.java
   testCases.add(new TestCase("your_test_id", "", ""));
   ```
   
   - `your_test_id`：测试项唯一标识（建议用英文小写+下划线）。
   - 名称和描述可先留空，稍后在主界面初始化。

2. 在主界面初始化测试项名称和描述
   
   打开 `MainActivity.java`，找到 `initializeTestCases()` 方法，按如下方式为新测试项设置名称和描述：
   
   ```java
   // MainActivity.java
   for (TestCase tc : testCases) {
       if ("your_test_id".equals(tc.id)) {
           tc.name = getString(R.string.your_test_name);
           tc.description = getString(R.string.your_test_desc);
           break;
       }
   }
   ```
   
   - `your_test_name` 和 `your_test_desc` 为字符串资源 ID，需在下一步添加。

3. 添加多语言字符串资源
   
   在 `app/src/main/res/values/strings.xml` 和 `app/src/main/res/values-zh/strings.xml` 中分别添加英文和中文描述。例如：
   
   ```xml
   <!-- values/strings.xml -->
   <string name="your_test_name">Your Test Name</string>
   <string name="your_test_desc">Description for your test case.</string>
   
   <!-- values-zh/strings.xml -->
   <string name="your_test_name">你的测试项名称</string>
   <string name="your_test_desc">该测试项的中文描述。</string>
   ```

4. 在测试代码中使用新测试项
   
   在需要响应该测试项的功能代码中，通过 `TestManager.getInstance().getSelectedTestCases()` 判断是否选中。例如：
   
   ```java
   for (TestCase tc : TestManager.getInstance().getSelectedTestCases()) {
       if ("your_test_id".equals(tc.id)) {
           // 执行你的测试逻辑
       }
   }
   ```

## 注意事项

---

- 测试项 `id` 必须唯一，且不可变。
- 名称和描述必须支持中英文国际化。
- 测试项的显示顺序与添加到 `TestManager` 的顺序一致。
- 不要在 UI 线程中执行耗时测试逻辑。
- 如需在测试模式下专用日志，请使用统一的 Logcat tag：`TTS_TEST`。

## 相关文档

---

- [CONTRIBUTING.md](./CONTRIBUTING.md)
- [信息图标开发指南.md](./信息图标开发指南.md)
- [README.md](./README.md) 