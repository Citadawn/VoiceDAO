# Android 状态栏文字颜色设置问题解决方案

## 问题现象

在本项目中，使用自定义 Toolbar 并设置深色背景（如 #272727）后，发现**状态栏的文字和图标颜色无法正确切换为白色**，导致状态栏内容在深色背景下不清晰。

## 原因分析

- Android 状态栏的文字/图标颜色由系统控制，默认会根据主题或 windowLightStatusBar 属性自动切换。
- 但自定义 Toolbar 并设置深色背景后，系统不会自动感知 Toolbar 的颜色，仍然可能显示黑色文字，导致与深色背景冲突。
- 仅在 style/themes.xml 设置 `<item name="android:windowLightStatusBar">false</item>` 并不能保证所有机型和系统版本都生效。
- 需要在代码中**动态设置 WindowInsetsController 或 SystemUiVisibility**，以确保状态栏文字颜色正确。

## 解决方法

### 1. 代码动态设置状态栏文字颜色

在 `MainActivity.java` 的 `onCreate` 方法中，添加如下代码：

```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R) {
    Window window = getWindow();
    WindowInsetsController insetsController = window.getInsetsController();
    if (insetsController != null) {
        // 设置状态栏文字为白色（适配深色背景）
        insetsController.setSystemBarsAppearance(0, WindowInsetsController.APPEARANCE_LIGHT_STATUS_BARS);
    }
} else {
    View decorView = getWindow().getDecorView();
    int flags = decorView.getSystemUiVisibility();
    // 清除浅色状态栏标志，强制状态栏文字为白色
    decorView.setSystemUiVisibility(flags & ~View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);
}
```

### 2. 主题设置

确保 `res/values/themes.xml` 中主题设置如下：

```xml
<item name="android:statusBarColor">@android:color/black</item>
<item name="android:windowLightStatusBar">false</item>
```

### 3. Toolbar 背景色统一

- 只在 style（如 `Widget.App.Toolbar`）中设置 Toolbar 背景色：

```xml
<item name="android:background">@color/main_dark</item>
```

- 布局文件中不要重复设置 Toolbar 的 `android:background`，避免覆盖 style。

## 注意事项

- Android 11（API 30）及以上推荐使用 `WindowInsetsController`，更低版本用 `SystemUiVisibility`。
- 必须在 setContentView 之后、Toolbar 初始化之前设置状态栏文字颜色。
- 如果主题或布局中有其它地方设置了 windowLightStatusBar，可能会被覆盖，需要以代码为准。
- 统一风格建议：背景色、状态栏色、Toolbar色都在 style 里统一设置，布局文件只做个性化调整。

## 参考代码片段

```java
// MainActivity.java -> onCreate()
Toolbar toolbar = findViewById(R.id.toolbar);
setSupportActionBar(toolbar);

if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R) {
    Window window = getWindow();
    WindowInsetsController insetsController = window.getInsetsController();
    if (insetsController != null) {
        insetsController.setSystemBarsAppearance(0, WindowInsetsController.APPEARANCE_LIGHT_STATUS_BARS);
    }
} else {
    View decorView = getWindow().getDecorView();
    int flags = decorView.getSystemUiVisibility();
    decorView.setSystemUiVisibility(flags & ~View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);
}
```

---

如遇到特殊机型或 ROM 兼容性问题，可适当调整调用时机或方式。 