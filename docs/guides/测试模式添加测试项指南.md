## 概述

---

### 什么是测试模式？

测试模式是本项目为开发者和测试人员提供的特殊功能模式。启用后，应用会显示一组可选的"测试项"
，用于验证特定功能、模拟异常场景或输出调试信息，帮助开发和质量保障。

### 如何进入测试模式？

1. 启动应用，进入主界面。
2. 点击右上角菜单按钮，选择"测试模式"菜单项。
3. 在弹出的对话框中勾选需要的测试项，点击"测试"按钮即可进入测试模式。
4. 进入测试模式后，主界面会有明显提示，并可随时退出测试模式。

### 什么是测试项？

测试项是测试模式下可单独启用的功能点。每个测试项对应一个具体的测试目标（如模拟语速设置失败、输出特定日志等），可多选组合，便于灵活测试和验证。

本指南面向未接触过本项目的开发者，介绍如何为测试模式添加新的测试项。请严格遵循本项目的 [CONTRIBUTING.md](../../CONTRIBUTING.md)
规范进行文档和代码编写（分层、分区、命名、国际化与资源管理等）。

## 基本原理

---

测试模式的测试项由 `TestCase` 类表示，所有测试项统一由 `TestManager` 管理，并在主界面初始化和显示。每个测试项包含唯一的
`id`、显示名称、描述等信息。

## 添加流程

---

### 步骤 1：在 TestManager 中注册测试项

打开 `app/src/main/java/com/citadawn/speechapp/ui/test/TestManager.java`，在构造方法中添加新的
`TestCase` 实例：

```java
// TestManager.java
// region 测试项注册
testCases.add(new TestCase("your_test_id", "", ""));
// endregion
```

**参数说明**：

- `your_test_id`：测试项唯一标识（建议用英文小写+下划线）
- 名称和描述可先留空，稍后在主界面初始化

### 步骤 2：在主界面初始化测试项名称和描述

打开 `MainActivity.java`，找到 `initializeTestCases()` 方法，按如下方式为新测试项设置名称和描述：

```java
// MainActivity.java
// region 测试模式
private void initializeTestCases() {
    for (TestCase tc : testCases) {
        if ("your_test_id".equals(tc.id)) {
            tc.name = getString(R.string.your_test_name);
            tc.description = getString(R.string.your_test_desc);
            break;
        }
    }
}
// endregion
```

**说明**：

- `your_test_name` 和 `your_test_desc` 为字符串资源 ID，需在下一步添加
- 相关逻辑放在 `// region 测试模式 // endregion` 分区中

### 步骤 3：添加多语言字符串资源

在 `app/src/main/res/values/strings.xml` 和 `app/src/main/res/values-zh/strings.xml` 中分别添加英文和中文描述：

```xml
<!-- values/strings.xml -->
<string name="your_test_name">Your Test Name</string>
<string name="your_test_desc">Description for your test case.</string>

<!-- values-zh/strings.xml -->
<string name="your_test_name">你的测试项名称</string>
<string name="your_test_desc">该测试项的中文描述。</string>
```

**规范要求**：

- 中英资源文件保持相同的 `name` 属性
- 字符串资源 ID 使用小写+下划线命名
- 描述内容应清晰说明测试项的功能和用途

### 步骤 4：在测试代码中使用新测试项

在需要响应该测试项的功能代码中，通过 `TestManager.getInstance().getSelectedTestCases()` 判断是否选中：

```java
// 在相关功能代码中添加测试逻辑
for (TestCase tc : TestManager.getInstance().getSelectedTestCases()) {
    if ("your_test_id".equals(tc.id)) {
        // 执行你的测试逻辑
        Log.d("TTS_TEST", "执行测试项: " + tc.name);

        // 示例：模拟异常场景
        // throw new RuntimeException("模拟测试异常");

        // 示例：输出调试信息
        // Log.i("TTS_TEST", "当前语速设置: " + currentSpeed);

        break; // 找到后退出循环
    }
}
```

## 完整示例

---

### 示例：添加"模拟网络异常"测试项

#### 1. 在 TestManager 中注册

```java
// TestManager.java
// region 测试项注册
testCases.add(new TestCase("simulate_network_error", "", ""));
// endregion
```

#### 2. 在主界面初始化

```java
// MainActivity.java
// region 测试模式
private void initializeTestCases() {
    for (TestCase tc : testCases) {
        if ("simulate_network_error".equals(tc.id)) {
            tc.name = getString(R.string.test_simulate_network_error);
            tc.description = getString(R.string.test_simulate_network_error_desc);
            break;
        }
    }
}
// endregion
```

#### 3. 添加字符串资源

```xml
<!-- values/strings.xml -->
<string name="test_simulate_network_error">Simulate Network Error</string>
<string name="test_simulate_network_error_desc">Simulate network connection failure for testing error handling.</string>

<!-- values-zh/strings.xml -->
<string name="test_simulate_network_error">模拟网络异常</string>
<string name="test_simulate_network_error_desc">模拟网络连接失败，用于测试错误处理机制。</string>
```

#### 4. 在功能代码中使用

```java
// 在网络请求相关代码中添加
for (TestCase tc : TestManager.getInstance().getSelectedTestCases()) {
    if ("simulate_network_error".equals(tc.id)) {
        Log.d("TTS_TEST", "模拟网络异常测试");
        throw new IOException("模拟网络连接失败");
    }
}
```

## 注意事项

---

### 必须遵循的规范

- **测试项 ID**：必须唯一，且不可变，建议使用英文小写+下划线命名
- **国际化**：名称和描述必须支持中英文国际化
- **资源管理**：颜色、尺寸、字符串均使用资源引用，不得硬编码
- **代码分区**：在涉及 UI 的类中，相关逻辑放在 `// region 测试模式 // endregion` 分区中
- **日志规范**：如需在测试模式下专用日志，请使用统一的 Logcat tag：`TTS_TEST`

### 开发建议

- **显示顺序**：测试项的显示顺序与添加到 `TestManager` 的顺序一致
- **性能考虑**：不要在 UI 线程中执行耗时测试逻辑
- **错误处理**：测试逻辑应包含适当的异常处理，避免影响应用稳定性
- **资源清理**：测试完成后应及时清理相关资源

### 常见问题

1. **测试项不显示**：检查是否正确在 `TestManager` 中注册，以及字符串资源是否正确添加
2. **测试逻辑不执行**：确认测试项 ID 是否与注册时一致，以及是否正确调用了 `getSelectedTestCases()`
3. **国际化不生效**：检查中英文字符串资源 ID 是否完全一致
4. **应用崩溃**：确保测试逻辑不会影响应用正常运行，添加适当的异常处理

## 相关文档

---

- [CONTRIBUTING.md](../../CONTRIBUTING.md) - 项目协作规范
- [信息图标开发指南](./信息图标开发指南.md) - 信息图标的标准模板和使用方法
- [README.md](../../README.md) - 项目说明文档
- [文档索引](../文档索引.md) - 返回文档索引
